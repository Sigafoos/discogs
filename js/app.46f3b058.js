(function(t){function e(e){for(var s,r,a=e[0],l=e[1],u=e[2],d=0,h=[];d<a.length;d++)r=a[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);c&&c(e);while(h.length)h.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],s=!0,a=1;a<n.length;a++){var l=n[a];0!==i[l]&&(s=!1)}s&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var s={},i={app:0},o=[];function r(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=s,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var c=l;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var s=n("85ec"),i=n.n(s);i.a},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("h1",[t._v("Discogs tracker")]),t.token?n("Discogs",{attrs:{token:t.token}}):n("TokenForm",{on:{submitted:t.save}})],1)},o=[],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"token"}},[n("h2",[t._v("Enter your personal access token")]),n("p",[t._v("Generate one in your "),n("b-link",{attrs:{href:"https://www.discogs.com/settings/developers"}},[t._v("Developers settings")]),t._v(". It is only stored on your device.")],1),n("form",{on:{submit:t.submit}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.token,expression:"token"}],attrs:{type:"text",required:"",name:"token"},domProps:{value:t.token},on:{input:function(e){e.target.composing||(t.token=e.target.value)}}}),n("button",{attrs:{type:"submit"}},[t._v("let's go")])])])},a=[],l={name:"TokenForm",data:function(){return{token:""}},methods:{submit:function(t){t.preventDefault(),this.$emit("submitted",this.token)}}},u=l,c=n("2877"),d=Object(c["a"])(u,r,a,!1,null,null,null),h=d.exports,f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",[t.error?n("b-alert",{attrs:{show:"",variant:"danger"}},[t._v(" "+t._s(t.error)+" ")]):n("div",[n("b-row",[n("h2",[t._v("Filters/sort")]),n("b-form-input",{attrs:{placeholder:"filter by title/artist"},on:{update:t.clearShown},model:{value:t.rawQuery,callback:function(e){t.rawQuery=e},expression:"rawQuery"}}),n("b-form-checkbox",{attrs:{id:"unlistened",name:"unlistened-1",value:"1","unchecked-value":""},on:{change:t.clearShown},model:{value:t.unlistened,callback:function(e){t.unlistened=e},expression:"unlistened"}},[t._v(" unlistened only ")])],1),n("b-row",[n("h2",[t._v(" Albums "),t.albums.length?n("span",{staticClass:"text-muted"},[t._v(" ("+t._s(t.shownAlbums.length)+" / "+t._s(t.albums.length)+") ")]):t._e()])]),n("b-row",[t.loading?n("p",[t._v(t._s(t.loadingMessage))]):t._e()]),n("b-row",t._l(t.albums,(function(e,s){return n("Album",{key:e.basic_information.instance_id,attrs:{data:e,id:s,listensID:t.listensID,lastListenedID:t.lastListenedID,filters:t.filters},on:{listen:t.listen,show:t.countShow}})})),1)],1)],1)},m=[],p=(n("a4d3"),n("e01a"),n("d28b"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2909")),b=(n("96cf"),n("1da1")),g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("b-col",{attrs:{cols:"3"}},[n("b-card",{staticClass:"m-2",attrs:{tag:"article","sub-title":t.artists,"no-body":""}},[n("b-link",{attrs:{href:t.url}},[n("b-card-img",{attrs:{src:t.image,alt:"Image",top:""}})],1),n("b-card-body",[n("b-card-title",[t._v(t._s(t.data.basic_information.title))]),n("b-card-sub-title",[t._v(t._s(t.artists))])],1),n("b-card-footer",[n("b-button",{on:{click:t.listen}},[t._v("Listened to")]),n("Listens",{attrs:{data:t.listens}})],1)],1)],1):t._e()},v=[],y=(n("c975"),n("a15b"),n("d81d"),n("a9e3"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-card-text",[t._v(t._s(t.data.count)+" "+t._s(t.listenText))])}),_=[],w={name:"Listens",props:{data:{type:Object,required:!0}},computed:{listenText:function(){return 1===this.data.count?"listen":"listens"}}},k=w,D=Object(c["a"])(k,y,_,!1,null,null,null),x=D.exports,O={name:"Album",props:["data","id","listensID","lastListenedID","filters"],components:{Listens:x},computed:{artists:function(){return this.data.basic_information.artists.map((function(t){return t.name})).join(", ")},image:function(){return this.data.basic_information.huge_thumb||this.data.basic_information.cover_image||this.data.thumb},lowerTitle:function(){return this.data.basic_information.title.toLowerCase()},lowerArtists:function(){return this.data.basic_information.artists.map((function(t){return t.name.toLowerCase()})).join(" ")},matchesQuery:function(){return!this.filters.query||(-1!==this.lowerTitle.indexOf(this.filters.query)||-1!==this.lowerArtists.indexOf(this.filters.query))},matchesListened:function(){return!this.filters.unlistened||0===this.listens.count},show:function(){return this.matchesQuery&&this.matchesListened},url:function(){return"https://www.discogs.com/release/"+this.data.basic_information.id}},created:function(){if(this.show&&this.$emit("show",this.id),this.data.notes){var t=!0,e=!1,n=void 0;try{for(var s,i=this.data.notes[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var o=s.value;o.field_id===this.listensID?this.listens.count=Number(o.value):o.field_id===this.lastListenedID&&(this.listens.latest=o.value)}}catch(r){e=!0,n=r}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}}},updated:function(){this.show&&this.$emit("show",this.id)},data:function(){return{listens:{count:0,latest:void 0}}},methods:{listen:function(){this.listens.count++,this.listens.latest=new Date,this.$emit("listen",this.id,this.listens)}}},j=O,L=Object(c["a"])(j,g,v,!1,null,null,null),S=L.exports,I="Listens",A="Last Listened",T={name:"Discogs",components:{Album:S},data:function(){return{loading:!0,loadingMessage:"loading...",error:void 0,listensID:void 0,lastListenedID:void 0,albums:[],shownAlbums:[],rawQuery:"",unlistened:void 0,username:void 0}},props:{token:{type:String,required:!0}},computed:{filters:function(){return{query:this.rawQuery.toLowerCase(),unlistened:this.unlistened}}},created:function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.username=localStorage.getItem("discogs_username"),this.username){t.next=5;break}return console.log("need a username"),t.next=5,fetch("https://api.discogs.com/oauth/identity",{headers:{Authorization:"Discogs token="+this.token}}).then((function(t){return t.json()})).then((function(t){e.username=t.username,localStorage.setItem("discogs_username",e.username)})).catch((function(t){return console.error(t)}));case 5:fetch("https://api.discogs.com/users/"+this.username+"/collection/fields",{headers:{Authorization:"Discogs token="+this.token}}).then((function(t){return t.json()})).then((function(t){var n=!0,s=!1,i=void 0;try{for(var o,r=t.fields[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var a=o.value;a.name===I?e.listensID=a.id:a.name===A&&(e.lastListenedID=a.id)}}catch(l){s=!0,i=l}finally{try{n||null==r.return||r.return()}finally{if(s)throw i}}e.listensID?e.lastListenedID?e.fetchAlbums():e.error='You do not have a custom field named "Last Listened". Unfortunately this has to be created manually. Please add it in your collection settings.':e.error='You do not have a custom field named "Listens". Unfortunately this has to be created manually. Please add it in your collection settings.'})).catch((function(t){return console.error(t)}));case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:{fetchAlbums:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;fetch("https://api.discogs.com/users/"+this.username+"/collection/folders/0/releases?sort=added&page="+t,{headers:{Authorization:"Discogs token="+this.token}}).then((function(t){return t.json()})).then(this.appendAlbums).catch((function(t){return console.error(t)}))},appendAlbums:function(t){var e;(e=this.albums).push.apply(e,Object(p["a"])(t.releases)),console.log(t),t.pagination.page<t.pagination.pages?(this.loadingMessage="loading ("+Math.floor(t.pagination.page/t.pagination.pages*100)+"%)",this.fetchAlbums(t.pagination.page+1)):this.loading=!1},listen:function(t,e){var n=this.albums[t];fetch("https://api.discogs.com/users/"+this.username+"/collection/folders/0/releases/"+n.basic_information.id+"/instances/"+n.instance_id+"/fields/"+this.listensID,{method:"POST",body:JSON.stringify({value:String(e.count)}),headers:{Authorization:"Discogs token="+this.token,"Content-Type":"application/json"}}).catch((function(t){return console.error(t)})),fetch("https://api.discogs.com/users/"+this.username+"/collection/folders/0/releases/"+n.basic_information.id+"/instances/"+n.instance_id+"/fields/"+this.lastListenedID,{method:"POST",body:JSON.stringify({value:String(e.latest)}),headers:{Authorization:"Discogs token="+this.token,"Content-Type":"application/json"}}).catch((function(t){return console.error(t)}))},countShow:function(t){this.shownAlbums.push(t)},clearShown:function(){console.log("clearing"),this.shownAlbums=[]}}},P=T,$=Object(c["a"])(P,f,m,!1,null,null,null),M=$.exports,q={name:"App",components:{Discogs:M,TokenForm:h},data:function(){return{token:void 0}},created:function(){this.token=localStorage.getItem("discogs_token")},methods:{save:function(t){console.log(t),this.token=t,localStorage.setItem("discogs_token",t)}}},C=q,Q=(n("034f"),Object(c["a"])(C,i,o,!1,null,null,null)),E=Q.exports,z=n("5f5b"),F=n("b1e0");n("f9e3"),n("2dd8");s["default"].use(z["a"]),s["default"].use(F["a"]),s["default"].config.productionTip=!1,new s["default"]({render:function(t){return t(E)}}).$mount("#app")},"85ec":function(t,e,n){}});
//# sourceMappingURL=app.46f3b058.js.map